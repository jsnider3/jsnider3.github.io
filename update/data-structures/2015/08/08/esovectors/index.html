<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Esovectors</title>
    <meta name="viewport" content="width=device-width initial-scale=1">
    <meta name="description" content="An attempt at a blog by someone who thinks Haskell is cool.">
    <link rel="canonical" href="http://www.joshuasnider.com/update/data-structures/2015/08/08/esovectors/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61510914-1', 'auto');
  ga('send', 'pageview');

</script>



    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">(\x -> "Blog")</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/"> Home </a>
        
          
          
        
          
          
            <a class="page-link" href="/about/">About</a>
          
        
          
          
        
          
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Esovectors</h1>
    <p class="meta">Aug 8, 2015</p>
  </header>

  <article class="post-content">
  <p>In practical terms, resizable arrays (implemented by <code>std::vector</code> in
C++)<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> are a very good data structure and in most respects compare
favorably to linked lists. They fit better into memory caches, have less
overhead, and support indexing in constant time. Their actual downsides are that
inserting and deleting in arbitrary locations takes linear time. This is
because we need to move up to the entire array when we change the first
element in it. In addition, we will also need to move the entire array
when it changes size too much. The reallocation amortizes away to be a
constant time, but it’s still an occasional<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> <code>O(n)</code> for
insertions/deletions within a constant of the end.</p>

<p>I’ll introduce a variant of the resizable array which allows us to have
constant <code>O(n)</code> complexity for insertions and deletions at the end and see
if it can solve the issue of arbitrary changes taking <code>O(n)</code> time. I call
these “esovectors” as they are an esoteric version of a vector.<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup></p>

<p>The way current resizable arrays work is that when you reach a certain
point, you allocate an entirely new block of memory, copy everything over
to it, and then free the block of memory you were previously used. This
works well, but still means that you’re obliged to copy blocks of unbounded
size. An alternative approach is to when we reach
a limit, allocate a second array, copy a constant amount over, and then copy
another constant of us over. By adjusting the point at which we reallocate
and the amount that we copy over, we can make sure that our old array is
empty at the same time our new array becomes full. For indexing operations,
we just need to check which buffer the nth element would be in and then index
into that one as normal. Like in normal vectors, indexing continues to take
<code>O(1)</code> time.</p>

<p>The additional space needed by this is <code>O(n)</code>, which matches the <code>O(n)</code> used
by normal vectors, but it’s a worse <code>O(n)</code> since we need to maintain a new
array almost twice as big as our old away, whereas vectors are at worst
half full.<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup></p>

<p>However, a critical issue to consider is the cost of memory allocation,
which greatly exceeds the cost of writing a single element of an array,
though is also trivially fast. The running time of <code>malloc</code> is entirely
dependent on the implementation chosen by the system, but in most cases
is unrelated to the number of bytes we are requesting. We shall assume
that our <code>malloc</code> uses two level segregate fit<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup> which is <code>O(1)</code>
time. Therefore, <code>malloc</code> does not affect our worst case appending performance.</p>

<p>I’ve shown how to modify dynamic arrays to support appending and removing
from the end in constant time, not just amortized constant time. Another
data type that is frequently implemented using dynamic arrays is the
double ended queue, which in addition to supporting the same operations
as dynamic arrays in the same time, they support popping and inserting
at the beginning in amortized constant time. I will leave it as an exercise
to the reader how to extend esovectors to support this behavior in
non-amortized constant time.<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup></p>

<hr />

<p><strong>Footnotes:</strong></p>

<div class="footnotes">
  <ol>
  <li id="fn:1">They have many names: array lists, growable arrays, etc. Wikipedia calls them <a href="https://en.wikipedia.org/wiki/Dynamic_array">dynamic arrays.</a><a href="#fnref:1" rev="footnote">↩</a></li>
  <li id="fn:2">How often this occasional reallocation happens depends on the growth factor 'g' which determines how much bigger the array becomes each time it's reallocated. There is some interesting reading on this topic <a href="https://github.com/facebook/folly/blob/master/folly/docs/FBVector.md">here.</a><a href="#fnref:2" rev="footnote">↩</a></li>
  <li id="fn:3">I have an implementation and test cases <a href="https://github.com/jsnider3/Workspace/tree/master/Esovector">here.</a><a href="#fnref:3" rev="footnote">↩</a></li>
  <li id="fn:4">The worst case for both is when we have 'n' elements in an array of size 'n' and try to insert an additional element. Traditional vectors allocate a new array of size '2n' and then use it to store 'n + 1' elements. For esovectors we allocate a new array of size '2n', put 2 elements in it, and leave 'n - 1' elements in our old array. This assumes a growth factor of 2, which is common but inefficient. See the link in footnote 2.<a href="#fnref:4" rev="footnote">↩</a></li> 
  <li id="fn:5">Introduced in <a href="http://www.gii.upv.es/tlsf/files/ecrts04_tlsf.pdf">this paper</a>.<a href="#fnref:5" rev="footnote">↩</a></li>
  <li id="fn:6">Read this as "I want someone else to do my work for me."<a href="#fnref:6" rev="footnote">↩</a></li>
  </ol>
</div>

  <footer><small>Click <a href="https://github.com/jsnider3/jsnider3.github.io/issues/new">here</a>
  to suggest a topic through GitHub. If you don't have a GitHub, feel free to 
  <a href='mailto:josh@joshuasnider.com'>email me.</small></footer>

  </article>

  
    <div align="left">
    <a class="prev" href="/project/2015/07/08/quis-custodiet/">&laquo; The Most Influential Works, According to TvTropes</a>
    </div>
  
  
    <div align="right">
    <a class="next" href="/update/android/gaming/2015/08/17/tictactoe/">Unbeatable Tic Tac Toe &raquo;</a>
    </div>
  

</div>

      </div>
    </div>

    
<div id="disqus_thread" class="wrap"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jsnider3';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading">(\x -> "Blog")</h2>

    <div class="footer-col-1 column">
      <ul>
        <li>(\x -> "Blog")</li>
        <li><a href="mailto:josh@joshuasnider.com">josh@joshuasnider.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/jsnider3">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">jsnider3</span>
          </a>
        </li>
        <li>
          <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
          <script type="IN/MemberProfile" data-id="https://www.linkedin.com/in/jsnider3" data-format="hover" data-related="false"></script>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">An attempt at a blog by someone who thinks Haskell is cool.</p>
    </div>

  </div>

</footer>


    </body>
</html>
